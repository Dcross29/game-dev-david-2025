<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Funny Little Goober</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #222;
  font-family: sans-serif;
}

#game {
  position: relative;
  width: 100vw;
  height: 100vh;
}

/* Sprites */
#player, #goober {
  position: absolute;
  width: 48px;
  height: 48px;
}

#player {
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
}

#goober {
  top: 40%;
  left: 50%;
  transform: translateX(-50%);
}

/* Doors */
.door {
  position: absolute;
  width: 80px;
  height: 120px;
  background: #555;
  border: 3px solid #333;
}

#doorLeft { top: 10%; left: 20%; }
#doorRight { top: 10%; right: 20%; }

/* Dialogue */
#dialogueBox {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 15px 20px;
  border-radius: 10px;
  max-width: 500px;
  display: none;
  z-index: 1000;
}

#choices button {
  display: block;
  margin: 8px auto;
  padding: 6px 14px;
}
</style>
</head>

<body>

<div id="game">
  <img id="player" src="player.gif">
  <img id="goober" src="goober.gif">

  <div id="doorLeft" class="door"></div>
  <div id="doorRight" class="door"></div>
</div>

<div id="dialogueBox">
  <!-- AUDIO PLACEHOLDERS -->
  <audio id="dialogueAudio"></audio>
  <audio id="deathAudio"></audio>

  <div id="dialogueText"></div>
  <div id="choices"></div>
</div>

<script>
/* ===== STATE ===== */
let px = window.innerWidth / 2 - 24;
let py = window.innerHeight - 90;
let speed = 4;
let locked = false;
let knowsRightDoor = false;

/* ===== MOVEMENT ===== */
document.addEventListener("keydown", e => {
  if (locked) return;

  if (e.key === "w") py -= speed;
  if (e.key === "s") py += speed;
  if (e.key === "a") px -= speed;
  if (e.key === "d") px += speed;

  player.style.left = px + "px";
  player.style.top = py + "px";

  checkGoober();
  checkDoors();
});

/* ===== DIALOGUE ENGINE ===== */
const box = dialogueBox;
const textEl = dialogueText;
const choicesEl = choices;
const dialogueAudio = document.getElementById("dialogueAudio");

function typeText(text, done) {
  textEl.textContent = "";
  let i = 0;

  const interval = setInterval(() => {
    textEl.textContent += text[i++];
    if (i >= text.length) {
      clearInterval(interval);
      done && done();
    }
  }, 45); // slow subtitles
}

function showDialogue(node) {
  locked = true;
  box.style.display = "block";
  choicesEl.innerHTML = "";

  dialogueAudio.src = ""; // add later
  dialogueAudio.play();

  typeText(node.text, () => {
    if (node.choices) {
      node.choices.forEach(c => {
        const b = document.createElement("button");
        b.textContent = c.label;
        b.onclick = () => handleNode(c.next);
        choicesEl.appendChild(b);
      });
    } else {
      setTimeout(() => {
        locked = false;
        box.style.display = "none";
      }, 600);
    }
  });
}

function handleNode(n) {
  if (n.death) return death();
  if (n.learnDoor) knowsRightDoor = true;
  showDialogue(n);
}

/* ===== DIALOGUE TREE ===== */
const dialogueTree = {
  text: "What brings you here.",
  choices: [
    {
      label: "Which door has the bubble?",
      next: {
        text: "The right door.",
        learnDoor: true
      }
    },
    {
      label: "What’s with your one hair?",
      next: {
        text: "It’s not hair. It’s a nerve ending.",
        choices: [
          {
            label: "Pull it",
            next: { death: true }
          },
          {
            label: "Don’t pull it",
            next: {
              text: "Now ask about the door.",
              choices: [
                {
                  label: "Which door?",
                  next: {
                    text: "The right door.",
                    learnDoor: true
                  }
                }
              ]
            }
          }
        ]
      }
    }
  ]
};

/* ===== PROXIMITY CHECK ===== */
function checkGoober() {
  const dx = Math.abs(px - goober.offsetLeft);
  const dy = Math.abs(py - goober.offsetTop);
  if (dx < 50 && dy < 50 && !locked) {
    showDialogue(dialogueTree);
  }
}

/* ===== DOORS ===== */
function checkDoors() {
  if (collide(player, doorRight) && knowsRightDoor) {
    location.href = "levelNext.html";
  }

  if (collide(player, doorLeft)) {
    antiGooberEnding();
  }
}

function collide(a, b) {
  return !(
    a.offsetLeft > b.offsetLeft + b.offsetWidth ||
    a.offsetLeft + a.offsetWidth < b.offsetLeft ||
    a.offsetTop > b.offsetTop + b.offsetHeight ||
    a.offsetTop + a.offsetHeight < b.offsetTop
  );
}

/* ===== ENDINGS ===== */
function death() {
  document.body.innerHTML =
    `<img src="Explode.gif" style="width:100vw;height:100vh;">`;

  setTimeout(() => {
    document.body.innerHTML =
      `<h1 style="color:red;text-align:center;margin-top:40vh">
        Game Over<br>
        <button onclick="location.reload()">Restart</button>
      </h1>`;
  }, 2500);
}

function antiGooberEnding() {
  document.body.innerHTML =
    `<h1 style="color:white;text-align:center;margin-top:40vh">
      Dungeon of Eternal Suffering and Anti-Sillyness<br><br>
      Ending Unlocked:<br>
      <b>Prejudice-Filled Anti-Goober</b>
    </h1>`;
}
</script>

</body>
</html>
