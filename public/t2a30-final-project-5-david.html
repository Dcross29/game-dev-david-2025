<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Funny Little Goober</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #777;
  font-family: sans-serif;
}

#game {
  position: relative;
  width: 100vw;
  height: 100vh;
}

/* ===== WALKABLE FLOOR ===== */
.floor {
  position: absolute;
  background: #bdbdbd;
}

/* Main hallway */
#floorUp {
  width: 140px;
  height: 50%;
  left: 50%;
  bottom: 0;
  transform: translateX(-50%);
}

/* Side halls */
#floorLeft {
  width: 40%;
  height: 140px;
  top: 26%;
  left: 0;
}

#floorRight {
  width: 40%;
  height: 140px;
  top: 26%;
  right: 0;
}

/* ===== WALLS ===== */
.wall {
  position: absolute;
  background: #555;
}

/* Vertical walls */
#wallUpL { left: 50%; bottom: 0; width: 10px; height: 50%; transform: translateX(-80px); }
#wallUpR { left: 50%; bottom: 0; width: 10px; height: 50%; transform: translateX(70px); }

/* Horizontal walls */
#wallLeftTop { left: 0; top: 26%; width: 40%; height: 10px; }
#wallLeftBot { left: 0; top: calc(26% + 140px); width: 40%; height: 10px; }

#wallRightTop { right: 0; top: 26%; width: 40%; height: 10px; }
#wallRightBot { right: 0; top: calc(26% + 140px); width: 40%; height: 10px; }

/* ===== SPRITES ===== */
#player {
  position: absolute;
  width: 48px;
  height: 48px;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
}

#goober {
  position: absolute;
  width: 110px;   /* BIGGER AGAIN */
  height: 110px;
  top: 23%;
  left: 50%;
  transform: translateX(-50%);
  z-index: 6;
}

/* ===== DOORS ===== */
.door {
  position: absolute;
  width: 90px;
  height: 140px;
  background: #888;
  border: 4px solid #444;
}

#doorLeft { top: 19%; left: 12%; }
#doorRight { top: 19%; right: 12%; }

/* ===== DIALOGUE ===== */
#dialogueBox {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 15px 20px;
  border-radius: 10px;
  max-width: 520px;
  display: none;
  z-index: 1000;
}

#choices button {
  display: block;
  margin: 8px auto;
  padding: 6px 14px;
}
</style>
</head>

<body>

<div id="game">

  <!-- FLOORS -->
  <div id="floorUp" class="floor"></div>
  <div id="floorLeft" class="floor"></div>
  <div id="floorRight" class="floor"></div>

  <!-- WALLS -->
  <div id="wallUpL" class="wall"></div>
  <div id="wallUpR" class="wall"></div>
  <div id="wallLeftTop" class="wall"></div>
  <div id="wallLeftBot" class="wall"></div>
  <div id="wallRightTop" class="wall"></div>
  <div id="wallRightBot" class="wall"></div>

  <!-- DOORS -->
  <div id="doorLeft" class="door"></div>
  <div id="doorRight" class="door"></div>

  <!-- SPRITES -->
  <img id="player" src="player.gif">
  <img id="goober" src="goober.gif">

</div>

<div id="dialogueBox">
  <div id="dialogueText"></div>
  <div id="choices"></div>
</div>

<script>
let px = window.innerWidth / 2 - 24;
let py = window.innerHeight - 90;
let speed = 4;

let locked = false;
let talked = false;
let knowsRight = false;

const floors = document.querySelectorAll(".floor");

/* ===== MOVEMENT + WALL CLAMP ===== */
document.addEventListener("keydown", e => {
  if (locked) return;

  let nx = px;
  let ny = py;

  if (e.key === "w") ny -= speed;
  if (e.key === "s") ny += speed;
  if (e.key === "a") nx -= speed;
  if (e.key === "d") nx += speed;

  if (onFloor(nx, ny)) {
    px = nx;
    py = ny;
  }

  player.style.left = px + "px";
  player.style.top = py + "px";

  checkGoober();
  checkDoors();
});

/* ===== FLOOR CHECK ===== */
function onFloor(x, y) {
  const temp = { offsetLeft:x, offsetTop:y, offsetWidth:48, offsetHeight:48 };

  return [...floors].some(f => collide(temp, f));
}

/* ===== COLLISION ===== */
function collide(a, b) {
  return !(
    a.offsetLeft > b.offsetLeft + b.offsetWidth ||
    a.offsetLeft + a.offsetWidth < b.offsetLeft ||
    a.offsetTop > b.offsetTop + b.offsetHeight ||
    a.offsetTop + a.offsetHeight < b.offsetTop
  );
}

/* ===== GOOBER ===== */
function checkGoober() {
  if (talked) return;

  if (collide(player, goober)) {
    talked = true;
    locked = true;
    showDialogue();
  }
}

/* ===== DIALOGUE ===== */
function showDialogue() {
  dialogueBox.style.display = "block";
  dialogueText.textContent =
    "I am the Funny Little Goober That Tells Lies.\nWhich door do you think has the bubble?";

  choices.innerHTML = "";

  addChoice("Ask which door", () => {
    dialogueText.textContent = "The right door.";
    knowsRight = true;
    endDialogue();
  });

  addChoice("Ask about his hair", () => {
    dialogueText.textContent = "Itâ€™s a nerve ending.";
    choices.innerHTML = "";
    addChoice("Pull it", death);
    addChoice("Don't pull it", () => {
      dialogueText.textContent = "Then ask about the door.";
      choices.innerHTML = "";
      addChoice("Which door?", () => {
        dialogueText.textContent = "The right door.";
        knowsRight = true;
        endDialogue();
      });
    });
  });
}

function addChoice(text, fn) {
  const b = document.createElement("button");
  b.textContent = text;
  b.onclick = fn;
  choices.appendChild(b);
}

function endDialogue() {
  setTimeout(() => {
    locked = false;
    dialogueBox.style.display = "none";
  }, 600);
}

/* ===== DOORS ===== */
function checkDoors() {
  if (knowsRight && collide(player, doorRight)) {
    location.href = "levelNext.html";
  }
  if (collide(player, doorLeft)) {
    document.body.innerHTML =
      "<h1 style='text-align:center;margin-top:40vh'>Dungeon of Eternal Suffering<br>Ending: Prejudice-Filled Anti-Goober</h1>";
  }
}

/* ===== DEATH ===== */
function death() {
  document.body.innerHTML =
    "<img src='Explode.gif' style='width:100vw;height:100vh'>";
}
</script>

</body>
</html>
