<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goober Room - Birdseye View</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:#222;
  font-family:sans-serif;
}
#gameArea{
  width:100vw;
  height:100vh;
  position:relative;
  background:#222; /* no background image */
}
#player{
  width:60px;
  height:60px;
  position:absolute;
  bottom:50px;
  left:50%;
  transform:translateX(-50%);
  z-index:3;
}
#goober{
  width:120px; /* bigger */
  position:absolute;
  left:50%;
  top:60%;   /* lower on the screen */
  transform:translate(-50%, -50%);
  z-index:2;
}
.door{
  width:80px;
  height:120px;
  position:absolute;
  top:20%; /* doors above goober */
  z-index:4; /* above goober */
  background:#5a3b28;
  border:5px solid #3a2416;
  cursor:pointer;
}
#doorLeft{left:30%;}
#doorRight{right:30%;}

#dialogueBox{
  position:fixed;
  bottom:40px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.85);
  color:white;
  padding:20px;
  border-radius:15px;
  max-width:500px;
  text-align:center;
  display:none;
  z-index:1000;
}
#choices button{
  display:block;
  margin:10px auto;
  padding:10px 20px;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="gameArea">
  <img id="player" src="player.gif">
  <img id="goober" src="goober.gif">
  <div id="doorLeft" class="door"></div>
  <div id="doorRight" class="door"></div>
</div>

<div id="dialogueBox">
  <div id="dialogueText"></div>
  <div id="choices"></div>
</div>

<script>
// ===== GAME VARIABLES =====
const player = document.getElementById("player");
const goober = document.getElementById("goober");
const dialogueBox = document.getElementById("dialogueBox");
const textEl = document.getElementById("dialogueText");
const choicesEl = document.getElementById("choices");

let keys = {};
let gooberSpoken=false;
let dialogueFinished=false;

// ===== DIALOGUE TREE =====
const dialogue = {
  text:"Hi! I'm the funny little goober that tells lies.",
  choices:[
    {
      label:"Which door has the bubble?",
      next:{text:"The bubble is behind the right door."}
    },
    {
      label:"What's with your one hair?",
      next:{
        text:"Oh that? That's actually a nerve ending.",
        choices:[
          {label:"Pull it", next:{text:"HEYâ€”DON'T TOUCH THAT!"}},
          {label:"Don't pull it", next:{text:"The bubble is behind the right door."}}
        ]
      }
    }
  ]
};

// ===== TYPEWRITER =====
function type(text, cb){
  textEl.textContent="";
  let i=0;
  const speed=70;
  const t=setInterval(()=>{
    textEl.textContent+=text[i++];
    if(i>=text.length){
      clearInterval(t);
      cb && cb();
    }
  },speed);
}

// ===== DIALOGUE FUNCTIONS =====
function show(node){
  dialogueBox.style.display="block";
  choicesEl.innerHTML="";
  type(node.text,()=>{
    if(node.choices){
      node.choices.forEach(c=>{
        const b=document.createElement("button");
        b.textContent=c.label;
        b.onclick=()=>handle(c.next);
        choicesEl.appendChild(b);
      });
    } else {
      dialogueFinished=true; // mark dialogue as finished
    }
  });
}

function handle(n){
  show(n);
}

function startDialogue(){
  if(gooberSpoken) return;
  gooberSpoken=true;
  show(dialogue);
}

// ===== PLAYER MOVEMENT =====
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

function movePlayer(){
  let rect = player.getBoundingClientRect();
  let speed=4;

  if(keys['w'] && rect.top>0) player.style.top=(player.offsetTop-speed)+'px';
  if(keys['s'] && rect.bottom<window.innerHeight) player.style.top=(player.offsetTop+speed)+'px';
  if(keys['a'] && rect.left>0) player.style.left=(player.offsetLeft-speed)+'px';
  if(keys['d'] && rect.right<window.innerWidth) player.style.left=(player.offsetLeft+speed)+'px';

  let p = player.getBoundingClientRect();
  let g = goober.getBoundingClientRect();

  // interact with goober
  if(p.left<g.right && p.right>g.left && p.top<g.bottom && p.bottom>g.top){
    startDialogue();
  }

  // interact with doors only after dialogue finished
  const leftDoor = document.getElementById("doorLeft").getBoundingClientRect();
  const rightDoor = document.getElementById("doorRight").getBoundingClientRect();

  if(dialogueFinished){
    if(p.left<leftDoor.right && p.right>leftDoor.left && p.top<leftDoor.bottom && p.bottom>leftDoor.top){
      alert("Left Door: Wrong! Try the right door.");
    }
    if(p.left<rightDoor.right && p.right>rightDoor.left && p.top<rightDoor.bottom && p.bottom>rightDoor.top){
      alert("Right Door: Correct! Proceed to next level.");
      // Uncomment the next line to go to next level
      // location.href='levelNext.html';
    }
  }

  requestAnimationFrame(movePlayer);
}

requestAnimationFrame(movePlayer);
</script>

</body>
</html>
