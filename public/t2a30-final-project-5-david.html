<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Goober Hallway - Level 5</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: sans-serif;
    background: #222;
  }

  #gameArea {
    width: 100vw;
    height: 100vh;
    position: relative;
  }

  #player, #goober {
    position: absolute;
    width: 60px;
    height: 60px;
  }

  #doorLeft, #doorRight {
    position: absolute;
    width: 80px;
    height: 120px;
    background: #555;
    border: 3px solid #333;
  }

  #dialogueBox {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    max-width: 500px;
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    display: none;
    z-index: 1000;
  }

  #dialogueChoices button {
    display: block;
    margin: 8px auto;
    padding: 8px 15px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="gameArea">
  <img id="player" src="player.gif" style="left:50%; top:80%;">
  <img id="goober" src="goober.gif" style="left:50%; top:40%; transform:translateX(-50%);">
  <div id="doorLeft" style="left:20%; top:10%;"></div>
  <div id="doorRight" style="left:70%; top:10%;"></div>
</div>

<div id="dialogueBox">
  <audio id="dialogueAudio"></audio>
  <div id="dialogueText"></div>
  <div id="dialogueChoices"></div>
</div>

<script>
// ===== PLAYER MOVEMENT =====
const player = document.getElementById("player");
let px = window.innerWidth/2 - 30;
let py = window.innerHeight*0.8;
let speed = 4;
let dialogueActive = false;

document.addEventListener('keydown', e => {
  if(dialogueActive) return;
  if(e.key==='w'||e.key==='W') py -= speed;
  if(e.key==='s'||e.key==='S') py += speed;
  if(e.key==='a'||e.key==='A') px -= speed;
  if(e.key==='d'||e.key==='D') px += speed;
  player.style.left = px+'px';
  player.style.top = py+'px';
  checkGooberProximity();
});

// ===== GOOBER DIALOGUE =====
const goober = document.getElementById("goober");
const dialogueBox = document.getElementById("dialogueBox");
const dialogueText = document.getElementById("dialogueText");
const dialogueChoices = document.getElementById("dialogueChoices");
const dialogueAudio = document.getElementById("dialogueAudio");

function checkGooberProximity(){
  // simple proximity trigger
  let gx = goober.offsetLeft + 30;
  let gy = goober.offsetTop + 30;
  let dx = px+30 - gx;
  let dy = py+30 - gy;
  if(Math.abs(dx)<60 && Math.abs(dy)<60){
    startDialogue();
  }
}

// ===== DIALOGUE TREE =====
const dialogueTree = {
  text: "Funny little goober that tells lies: What brings you here?",
  audio: "audio/goober_intro.mp3",
  choices: [
    {
      label: "Which door has the bubble?",
      next: {
        text: "Funny little goober that tells lies: The right door is the correct one.",
        audio: "audio/goober_door.mp3",
        success: "rightDoor"
      }
    },
    {
      label: "Tell me about your one hair",
      next: {
        text: "Funny little goober that tells lies: It's not a hair, it's a nerve ending!",
        audio: "audio/goober_hair.mp3",
        choices: [
          {
            label: "Pull it!",
            next: { death: "deviousActs" }
          },
          {
            label: "Don't pull it",
            next: {
              text: "Funny little goober that tells lies: Now, back to the door question. The right door is the correct one.",
              audio: "audio/goober_door.mp3",
              success: "rightDoor"
            }
          }
        ]
      }
    }
  ]
};

// ===== TYPEWRITER =====
function typeWriter(text, done){
  dialogueText.textContent = "";
  let i = 0;
  const speed = 40; // slower
  const interval = setInterval(()=>{
    dialogueText.textContent += text[i++];
    if(i>=text.length){ clearInterval(interval); done && done(); }
  }, speed);
}

function showDialogue(node){
  dialogueActive = true;
  dialogueBox.style.display="block";
  dialogueChoices.innerHTML="";
  if(node.audio){ dialogueAudio.src = node.audio; dialogueAudio.play(); }
  typeWriter(node.text, ()=> {
    if(node.choices){
      node.choices.forEach(c=>{
        const btn = document.createElement("button");
        btn.textContent = c.label;
        btn.onclick = ()=>handleNext(c.next);
        dialogueChoices.appendChild(btn);
      });
    }
  });
}

function handleNext(n){
  if(!n) return;

  if(n.death){
    setTimeout(()=>{ playDeath(n.death); }, 500);
    return;
  }

  if(n.success){
    setTimeout(()=>{ playSuccess(n.success); }, 500);
    return;
  }

  showDialogue(n);
}

// ===== DEATH =====
function playDeath(type){
  dialogueBox.style.display="none";
  dialogueActive=true;
  document.body.innerHTML = `<img src="death.gif" style="width:100vw;height:100vh;">`;
  setTimeout(()=>{ 
    document.body.innerHTML = `<div style="color:red; text-align:center; font-size:40px; margin-top:40vh;">
      Game Over<br><button onclick="location.reload()">Restart</button></div>`;
  }, 2500);
}

// ===== SUCCESS =====
function playSuccess(type){
  dialogueBox.style.display="none";
  dialogueActive=true;
  document.body.innerHTML = `<img src="guardleave.gif" style="width:100vw;height:100vh;">`;
  setTimeout(()=>{ 
    document.body.innerHTML = `<div style="color:green; text-align:center; font-size:40px; margin-top:40vh;">
      Proceed<br><button onclick="window.location.href='level6.html'">Next Level</button></div>`;
  }, 26/14*1000); // gif duration in ms
}

// ===== START DIALOGUE =====
function startDialogue(){
  if(dialogueActive) return;
  showDialogue(dialogueTree);
}
</script>

</body>
</html>
