<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dialogue System - lvl 4</title>

<style>
  body {
    margin: 0;
    font-family: sans-serif;

    /* FIXED FULLSCREEN BACKGROUND */
    background-image: url('BubbleGuard.gif');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;

    height: 100vh;
    overflow: hidden;
  }

  #dialogueBox {
    position: fixed;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.85);
    color: white;
    padding: 20px;
    border-radius: 15px;
    max-width: 500px;
    text-align: center;
    display: none;
    z-index: 10000;
  }

  #dialogueChoices button {
    display: block;
    margin: 10px auto;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }

  /* FADE-IN OVERLAY */
  #fadeOverlay {
    position: fixed;
    inset: 0;
    background: black;
    z-index: 20000;
  }
</style>
</head>

<body>

<h1 align="center" style="color:red;">I will pop that bubble - lvl 4</h1>

<div id="fadeOverlay"></div>

<div id="dialogueBox">
  <div id="dialogueText"></div>
  <div id="dialogueChoices"></div>
</div>

<script>
/* === FADE IN PAGE === */
document.addEventListener("DOMContentLoaded", () => {
  const fade = document.getElementById("fadeOverlay");
  fade.style.transition = "opacity 1s";
  fade.style.opacity = 0;
  setTimeout(() => fade.style.display = "none", 1000);
});

/* === DIALOGUE TREE === */
const dialogueTree = {
  text: "What brings you here? If it's the door, turn. Now.",
  choices: [
    {
      text: "*say nothing*",
      next: {
        text: ".....\nHello?",
        choices: [
          { text: "*say nothing*", next: { death: true } },
          {
            text: "let me in",
            next: {
              text: "And why should I?",
              choices: [
                { text: "flaunt", next: { text: "Really!?", success: true } },
                { text: "reason", next: { death: true } }
              ]
            }
          }
        ]
      }
    },
    {
      text: "*offer a proposition*",
      next: {
        text: "Choose your method...",
        choices: [
          { text: "rock paper scissors", next: { rps: true } },
          {
            text: "give him whatever is in your pockets",
            next: { text: "uhhh, i got some pocket lint and an old bubblegun wrapper", death: true }
          },
          { text: "intimidation", next: { death: true } }
        ]
      }
    },
    {
      text: "*insult*",
      next: {
        text: "Choose how to insult...",
        choices: [
          {
            text: "insult his spear",
            next: { text: "No it's not! It's average… besides. It's how you use it", success: true }
          },
          {
            text: "make fun of his legs",
            next: { text: "like you'd know anything about muscle, twig-bones", death: true }
          }
        ]
      }
    }
  ]
};

/* === DIALOGUE SYSTEM === */
const dialogueBox = document.getElementById("dialogueBox");
const dialogueText = document.getElementById("dialogueText");
const dialogueChoices = document.getElementById("dialogueChoices");

function typeWriter(text, callback) {
  dialogueText.textContent = "";
  let i = 0;
  const speed = 60; // ⬅️ SLOWER typing

  const interval = setInterval(() => {
    dialogueText.textContent += text[i];
    i++;
    if (i >= text.length) {
      clearInterval(interval);
      if (callback) callback();
    }
  }, speed);
}

function showDialogue(node) {
  dialogueBox.style.display = "block";
  dialogueChoices.innerHTML = "";

  typeWriter(node.text, () => {
    if (node.choices) {
      node.choices.forEach(choice => {
        const btn = document.createElement("button");
        btn.textContent = choice.text;
        btn.onclick = () => {
          if (choice.next?.death) {
            document.body.innerHTML =
              `<img src="Death.gif" style="width:100vw;height:100vh;">`;
          } else if (choice.next?.rps) {
            alert("RPS game placeholder");
          } else if (choice.next) {
            showDialogue(choice.next);
          }
        };
        dialogueChoices.appendChild(btn);
      });
    }
  });
}

/* === START === */
showDialogue(dialogueTree);
</script>

</body>
</html>
