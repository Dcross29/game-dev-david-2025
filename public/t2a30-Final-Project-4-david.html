<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>I will pop that bubble - lvl 4</title>

<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: url("BubbleGuard.gif") center / cover no-repeat fixed;
  height: 100vh;
  overflow: hidden;
}

h1 {
  text-align: center;
  color: red;
  margin-top: 10px;
}

/* FADE */
#fadeOverlay {
  position: fixed;
  inset: 0;
  background: black;
  z-index: 20000;
}

/* DIALOGUE */
#dialogueBox {
  position: fixed;
  bottom: 50px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 20px;
  border-radius: 15px;
  max-width: 550px;
  text-align: center;
  display: none;
  z-index: 10000;
}

#dialogueChoices button {
  display: block;
  margin: 10px auto;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

/* SUCCESS */
#successScreen {
  position: fixed;
  inset: 0;
  background: black;
  display: none;
  z-index: 30000;
}

#successScreen img {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

#proceedBtn {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%);
  padding: 15px 30px;
  font-size: 20px;
  display: none;
  z-index: 40000;
  cursor: pointer;
}

/* DEATH */
#deathScreen {
  position: fixed;
  inset: 0;
  background: black;
  display: none;
  z-index: 50000;
}

#deathScreen img {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

/* GAME OVER */
#gameOver {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: red;
  z-index: 60000;
}

#gameOver button {
  margin-top: 20px;
  padding: 15px 30px;
  font-size: 20px;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>I will pop that bubble - lvl 4</h1>

<div id="fadeOverlay"></div>

<div id="dialogueBox">
  <div id="dialogueText"></div>
  <div id="dialogueChoices"></div>
</div>

<div id="successScreen">
  <img src="guardleave.gif">
</div>

<button id="proceedBtn" onclick="location.href='level5.html'">
  Proceed
</button>

<div id="deathScreen">
  <img src="Death.gif">
</div>

<div id="gameOver">
  <h1>GAME OVER</h1>
  <button onclick="location.reload()">Restart</button>
</div>

<script>
/* ===== FADE IN ===== */
window.onload = () => {
  const f = document.getElementById("fadeOverlay");
  f.style.transition = "opacity 1s";
  f.style.opacity = 0;
  setTimeout(()=>f.remove(),1000);
};

/* ===== CONSTANTS ===== */
const TYPE_SPEED = 80;
const GUARD_GIF_DURATION = 1857;
const DEATH_DURATION = 2500;

/* ===== DIALOGUE TREE ===== */
const dialogueTree = {
  text: "What brings you here. If it's the door, turn. Now.",
  choices: [

    {
      label: "*say nothing*",
      next: {
        text: ".....\nHello?",
        choices: [
          { label: "*say nothing*", next: { death: true } },
          {
            label: "let me in",
            next: {
              text: "And why should I?",
              choices: [
                {
                  label: "flaunt",
                  next: {
                    text: "Because I'm rich. If you go to that corner over there, I left some money.",
                    npcNext: { text: "Really!?", success: true }
                  }
                },
                {
                  label: "reason",
                  next: {
                    text: "You don't get paid enough for this.",
                    npcNext: { text: "I don't care.", death: true }
                  }
                }
              ]
            }
          }
        ]
      }
    },

    {
      label: "*offer a proposition*",
      next: {
        text: "State your offer.",
        choices: [
          { label: "rock paper scissors", next: { death: true } },
          {
            label: "give him whatever is in your pockets",
            next: {
              text: "Uhhh… I got some pocket lint and an old bubblegun wrapper.",
              death: true
            }
          },
          {
            label: "intimidation",
            next: {
              text: "You let me in, and I won't molly whop you right now.",
              death: true
            }
          }
        ]
      }
    },

    {
      label: "*insult*",
      next: {
        text: "Say it.",
        choices: [
          {
            label: "insult his spear",
            next: {
              text: "Your spear is small.",
              npcNext: {
                text: "No it's not! It's average… besides. It's how you use it.",
                success: true
              }
            }
          },
          {
            label: "make fun of his legs",
            next: {
              text: "Your legs are so thin, skip leg day?",
              npcNext: {
                text: "Like you'd know anything about muscle, twig-bones.",
                death: true
              }
            }
          }
        ]
      }
    }

  ]
};

/* ===== ENGINE ===== */
const box = document.getElementById("dialogueBox");
const textEl = document.getElementById("dialogueText");
const choicesEl = document.getElementById("dialogueChoices");

function typeWriter(text, done){
  textEl.textContent = "";
  let i = 0;
  const timer = setInterval(()=>{
    textEl.textContent += text[i++];
    if(i >= text.length){
      clearInterval(timer);
      done && done();
    }
  }, TYPE_SPEED);
}

function showDialogue(node){
  box.style.display = "block";
  choicesEl.innerHTML = "";

  typeWriter(node.text, () => {
    if(node.choices){
      node.choices.forEach(c=>{
        const btn = document.createElement("button");
        btn.textContent = c.label;
        btn.onclick = ()=>handleNext(c.next);
        choicesEl.appendChild(btn);
      });
    }
  });
}

function handleNext(n){
  if(!n) return;

  if(n.npcNext){
    showDialogue({ text: n.text, choices: [] });
    setTimeout(()=>handleNext(n.npcNext), TYPE_SPEED * n.text.length + 400);
    return;
  }

  if(n.success){
    box.style.display = "none";
    document.getElementById("successScreen").style.display = "block";
    setTimeout(()=>{
      document.getElementById("proceedBtn").style.display = "block";
    }, GUARD_GIF_DURATION);
    return;
  }

  if(n.death){
    box.style.display = "none";
    document.getElementById("deathScreen").style.display = "block";
    setTimeout(()=>{
      document.getElementById("gameOver").style.display = "flex";
    }, DEATH_DURATION);
    return;
  }

  showDialogue(n);
}

/* ===== START ===== */
showDialogue(dialogueTree);
</script>

</body>
</html>
