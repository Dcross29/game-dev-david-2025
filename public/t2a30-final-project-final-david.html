<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Final Level - Part 1</title>
<style>
body{
  margin:0;
  overflow:hidden;
  font-family:sans-serif;
  background:brown;
}

/* Room container */
#wakeRoom{
  width:100vw;
  height:100vh;
  position:relative;
}

/* First floor */
#firstFloor{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#8B4513;
  z-index:1;
}

/* CSS Bed */
#bed{
  position:absolute;
  width:150px;
  height:60px;
  left:80px;
  bottom:40px;
  background:#A0522D;
  border-top:20px solid #D2691E; /* mattress */
  border-radius:10px;
  z-index:2;
}

/* Stairs */
#stairs{
  position:absolute;
  bottom:0;
  left:60%;
  transform:translateX(-50%);
  width:200px;
  height:150px;
  z-index:2;
}
#stairs div{
  background:#654321;
  height:20px;
  margin-top:5px;
}

/* Lower floor */
#lowerFloor{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:2000px; /* tall floor for running */
  background:#444;
  display:none;
  z-index:0;
}

/* Player */
#player{
  position:absolute;
  z-index:10;
}

/* Bubble */
#bubble{
  position:absolute;
  width:80px;
  height:auto;
  display:none;
  z-index:9;
}

/* Dialogue */
#dialogue{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.85);
  padding:20px;
  border-radius:12px;
  max-width:600px;
  text-align:center;
  color:white;
  display:none;
  z-index:100;
}
#dialogue button{
  margin-top:10px;
  padding:10px 20px;
  font-size:16px;
}

/* Run arrow */
#runArrow{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:24px;
  color:red;
  display:none;
  z-index:101;
}

/* Final door */
#finalDoor{
  position:absolute;
  width:120px;
  height:200px;
  background:#222;
  border:4px solid white;
  text-align:center;
  line-height:200px;
  font-size:22px;
  display:none;
  cursor:pointer;
  z-index:10;
}
</style>
</head>
<body>

<div id="wakeRoom">
  <!-- First floor -->
  <div id="firstFloor">
    <div id="bed"></div>
    <div id="stairs">
      <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
  </div>

  <!-- Lower floor -->
  <div id="lowerFloor">
    <div id="finalDoor" style="top:1800px; left:80%;">Door</div>
  </div>

  <!-- Player -->
  <img id="player" src="mc.PNG">

  <!-- Bubble -->
  <img id="bubble" src="bubbleboss.gif">

  <!-- Run arrow -->
  <div id="runArrow">RUN ↓</div>
</div>

<div id="dialogue"></div>

<script>
const player = document.getElementById("player");
const firstFloor = document.getElementById("firstFloor");
const lowerFloor = document.getElementById("lowerFloor");
const stairs = document.getElementById("stairs");
const dialogue = document.getElementById("dialogue");
const bubble = document.getElementById("bubble");
const finalDoor = document.getElementById("finalDoor");
const runArrow = document.getElementById("runArrow");

let keys = {};
let alive = true;
let onFirstFloor = true;
let atStairs = false;
let bubbleChasing = false;
let autoScroll = false;

// Track player position
let playerX = 120;
let playerY = 60;
player.style.left = playerX + "px";
player.style.bottom = playerY + "px";

// Input
document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

// Movement
function movePlayer(){
  if(keys.a) playerX -= 4;
  if(keys.d) playerX += 4;
  if(keys.w) playerY += 4;
  if(keys.s) playerY -= 4;

  const rect = player.getBoundingClientRect();
  if(playerX < 0) playerX = 0;
  if(playerX > window.innerWidth - rect.width) playerX = window.innerWidth - rect.width;
  if(playerY < 0) playerY = 0;
  if(playerY > window.innerHeight - rect.height) playerY = window.innerHeight - rect.height;

  player.style.left = playerX + "px";
  player.style.bottom = playerY + "px";

  // First floor stairs check
  if(onFirstFloor && checkStairs()){
    if(!atStairs){
      atStairs = true;
      showDialogue(`<button onclick="goDownstairs()">Go downstairs</button>`);
    }
  } else {
    atStairs = false;
    if(onFirstFloor) hideDialogue();
  }

  // Bubble chasing logic
  if(bubbleChasing){
    if(playerX < bubble.offsetLeft) bubble.style.left = (parseInt(bubble.style.left)-2)+"px";
    if(playerX > bubble.offsetLeft) bubble.style.left = (parseInt(bubble.style.left)+2)+"px";
    if(playerY < bubble.offsetTop) bubble.style.top = (parseInt(bubble.style.top)-2)+"px";
    if(playerY > bubble.offsetTop) bubble.style.top = (parseInt(bubble.style.top)+2)+"px";
  }

  // Auto scroll floor
  if(autoScroll){
    lowerFloor.scrollTop += 3;
  }
}
setInterval(movePlayer,16);

function checkStairs(){
  const stairRect = stairs.getBoundingClientRect();
  const playerRect = player.getBoundingClientRect();
  return !(playerRect.right < stairRect.left || playerRect.left > stairRect.right || 
           playerRect.bottom < stairRect.top || playerRect.top > stairRect.bottom);
}

function showDialogue(html){
  dialogue.innerHTML = html;
  dialogue.style.display="block";
}
function hideDialogue(){
  dialogue.style.display="none";
}

// Go downstairs
function goDownstairs(){
  hideDialogue();
  onFirstFloor = false;
  firstFloor.style.display="none";
  lowerFloor.style.display="block";

  // Position player at bottom of lower floor
  playerX = window.innerWidth/2 - player.width/2;
  playerY = 40;
  player.style.left = playerX + "px";
  player.style.bottom = playerY + "px";

  // Bubble appears at top
  bubble.style.display="block";
  bubble.style.top = "0px";
  bubble.style.left = (window.innerWidth/2)+"px";

  setTimeout(bubbleConfront,500);
}

// Bubble confrontation
function bubbleConfront(){
  showDialogue(`
    The Bubble appears.<br>
    "Join me… or I shoot you."<br><br>
    <button onclick="joinBubble()">Join him</button>
    <button onclick="refuseBubble()">Refuse</button>
  `);
}

function joinBubble(){
  hideDialogue();
  alert("Join path would go here (BAD or SNAKE endings).");
}

function refuseBubble(){
  hideDialogue();
  runArrow.style.display="block";
  setTimeout(()=>{ bubbleChasing=true; autoScroll=true; },2000); // 2 sec headstart
}

// Final door
finalDoor.addEventListener("mouseenter", ()=>{
  location.href="finalSequence.html";
});
</script>

</body>
</html>
