<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Final Level - Part 1</title>
<style>
body{
  margin:0;
  overflow:hidden;
  font-family:sans-serif;
  background:black;
}

/* Wake-up room */
#wakeRoom{
  width:100vw;
  height:100vh;
  background: url('room.png') center/cover no-repeat;
  position:relative;
}

/* Player */
#player{
  position:absolute;
  width:80px;
  height:auto;
  left:50%;
  bottom:40px;
  transform:translateX(-50%);
  z-index:10;
}

/* Stairs */
#stairs{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:300px;
  z-index:2;
}

/* Dialogue box */
#dialogue{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.85);
  padding:20px;
  border-radius:12px;
  max-width:600px;
  text-align:center;
  color:white;
  display:none;
  z-index:100;
}
#dialogue button{
  margin-top:10px;
  padding:10px 20px;
  font-size:16px;
}

/* Bubble (chase) */
#bubble{
  position:absolute;
  width:100px;
  height:auto;
  top:0;
  left:50%;
  transform:translateX(-50%);
  display:none;
  z-index:9;
}

/* Door to final sequence */
#finalDoor{
  position:absolute;
  width:120px;
  height:200px;
  right:50px;
  bottom:50px;
  background:#222;
  border:4px solid white;
  text-align:center;
  line-height:200px;
  font-size:22px;
  display:none;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="wakeRoom">
  <img id="player" src="mc.PNG">
  <img id="stairs" src="stairs.png">
  <img id="bubble" src="bubbleboss.gif">
  <div id="finalDoor">Door</div>
</div>

<div id="dialogue"></div>

<script>
const player = document.getElementById("player");
const stairs = document.getElementById("stairs");
const dialogue = document.getElementById("dialogue");
const bubble = document.getElementById("bubble");
const finalDoor = document.getElementById("finalDoor");

let keys = {};
let alive = true;

/* Input */
document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

/* Show initial dialogue after load */
setTimeout(()=>{
  showDialogue(`
    You wake up.<br><br>
    <button onclick="walkDownstairs()">Go downstairs</button>
  `);
},500);

/* Dialogue helpers */
function showDialogue(html){
  dialogue.innerHTML = html;
  dialogue.style.display="block";
}
function hideDialogue(){
  dialogue.style.display="none";
}

/* Walk down stairs */
function walkDownstairs(){
  hideDialogue();
  let bottom = parseInt(player.style.bottom) || 40;
  const interval = setInterval(()=>{
    bottom += 3;
    player.style.bottom = bottom + "px";
    if(bottom >= 200){ // adjust to stairs bottom
      clearInterval(interval);
      bubbleConfront();
    }
  },16);
}

/* Bubble confrontation */
function bubbleConfront(){
  showDialogue(`
    The Bubble appears.<br>
    "Join me… or I shoot you."<br><br>
    <button onclick="joinBubble()">Join him</button>
    <button onclick="refuseBubble()">Refuse</button>
  `);
}

function joinBubble(){
  hideDialogue();
  // you can later add join paths / endings
  alert("Join path would go here (BAD or SNAKE endings).");
}

function refuseBubble(){
  hideDialogue();
  startChase();
}

/* ---------- Chase sequence ---------- */
function startChase(){
  bubble.style.display="block";
  bubble.style.top="0px";
  let bubbleY = 0;
  let playerX = parseInt(player.style.left);
  let chaseInterval = setInterval(()=>{
    if(!alive) { clearInterval(chaseInterval); return; }
    bubbleY += 3;
    bubble.style.top = bubbleY+"px";

    // simple player controls for left/right
    if(keys.a) playerX -= 4;
    if(keys.d) playerX += 4;
    if(playerX<0) playerX=0;
    if(playerX>window.innerWidth-80) playerX = window.innerWidth-80;
    player.style.left = playerX+"px";

    // if bubble reaches bottom → show door
    if(bubbleY >= window.innerHeight-150){
      clearInterval(chaseInterval);
      bubble.style.display="none";
      finalDoor.style.display="block";
    }
  },16);
}

/* Click final door to proceed */
finalDoor.addEventListener("click", ()=>{
  // This triggers the final sequence page
  location.href="finalSequence.html"; // page 2
});
</script>

</body>
</html>
