<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Final Level - Part 1</title>
<style>
body{
  margin:0;
  overflow:hidden;
  font-family:sans-serif;
  background:brown;
}

/* Wake-up room container */
#wakeRoom{
  width:100vw;
  height:100vh;
  position:relative;
}

/* Player */
#player{
  position:absolute;
  width:50px;
  height:auto;
  left:100px; /* bed position */
  bottom:60px;
  transform:translateX(0);
  z-index:10;
}

/* Stairs (CSS) */
#stairs{
  position:absolute;
  bottom:0;
  left:60%;
  transform:translateX(-50%);
  width:200px;
  height:150px;
  z-index:2;
}
#stairs div{
  background:#654321; /* dark brown */
  height:20px;
  margin-top:5px;
}

/* Dialogue box */
#dialogue{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.85);
  padding:20px;
  border-radius:12px;
  max-width:600px;
  text-align:center;
  color:white;
  display:none;
  z-index:100;
}
#dialogue button{
  margin-top:10px;
  padding:10px 20px;
  font-size:16px;
}

/* Bubble (chase) */
#bubble{
  position:absolute;
  width:80px;
  height:auto;
  top:0;
  left:50%;
  transform:translateX(-50%);
  display:none;
  z-index:9;
}

/* Door to final sequence */
#finalDoor{
  position:absolute;
  width:120px;
  height:200px;
  right:50px;
  bottom:50px;
  background:#222;
  border:4px solid white;
  text-align:center;
  line-height:200px;
  font-size:22px;
  display:none;
  cursor:pointer;
}
</style>
</head>
<body>

<div id="wakeRoom">
  <img id="player" src="mc.PNG">
  
  <!-- CSS Stairs -->
  <div id="stairs">
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
  </div>
  
  <img id="bubble" src="bubbleboss.gif">
  <div id="finalDoor">Door</div>
</div>

<div id="dialogue"></div>

<script>
const player = document.getElementById("player");
const stairs = document.getElementById("stairs");
const dialogue = document.getElementById("dialogue");
const bubble = document.getElementById("bubble");
const finalDoor = document.getElementById("finalDoor");

let keys = {};
let alive = true;
let onFirstFloor = true;

/* Input */
document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

/* Player movement */
function movePlayer(){
  let playerX = parseInt(player.style.left);
  let playerY = parseInt(player.style.bottom);

  if(keys.a) playerX -= 4;
  if(keys.d) playerX += 4;
  if(keys.w) playerY += 4;
  if(keys.s) playerY -= 4;

  // constrain to window
  if(playerX<0) playerX=0;
  if(playerX>window.innerWidth-50) playerX = window.innerWidth-50;
  if(playerY<0) playerY=0;
  if(playerY>window.innerHeight-50) playerY = window.innerHeight-50;

  player.style.left = playerX+"px";
  player.style.bottom = playerY+"px";

  // check if player reached stairs
  if(onFirstFloor && checkStairs(playerX, playerY)){
    showDialogue(`<button onclick="walkDownstairs()">Go downstairs</button>`);
  } else if(onFirstFloor) {
    hideDialogue();
  }
}

function checkStairs(px, py){
  const rect = stairs.getBoundingClientRect();
  const playerRect = player.getBoundingClientRect();
  return !(playerRect.right < rect.left || playerRect.left > rect.right || 
           playerRect.bottom < rect.top || playerRect.top > rect.bottom);
}

setInterval(movePlayer,16);

/* Dialogue helpers */
function showDialogue(html){
  dialogue.innerHTML = html;
  dialogue.style.display="block";
}
function hideDialogue(){
  dialogue.style.display="none";
}

/* Walk down stairs */
function walkDownstairs(){
  hideDialogue();
  onFirstFloor = false;
  let bottom = parseInt(player.style.bottom) || 60;
  const interval = setInterval(()=>{
    bottom -= 3; // move down visually
    player.style.bottom = bottom + "px";
    if(bottom <= 40){ // reached lower floor
      clearInterval(interval);
      bubbleWalkUp();
    }
  },16);
}

/* Bubble walks up before dialogue */
function bubbleWalkUp(){
  bubble.style.display="block";
  bubble.style.top = window.innerHeight + "px"; // start from bottom
  let bubbleY = window.innerHeight;
  const interval = setInterval(()=>{
    bubbleY -= 3;
    bubble.style.top = bubbleY + "px";
    if(bubbleY <= player.getBoundingClientRect().top){
      clearInterval(interval);
      bubbleConfront();
    }
  },16);
}

/* Bubble confrontation */
function bubbleConfront(){
  showDialogue(`
    The Bubble appears.<br>
    "Join me… or I shoot you."<br><br>
    <button onclick="joinBubble()">Join him</button>
    <button onclick="refuseBubble()">Refuse</button>
  `);
}

function joinBubble(){
  hideDialogue();
  alert("Join path would go here (BAD or SNAKE endings).");
}

function refuseBubble(){
  hideDialogue();
  startChase();
}

/* ---------- Chase sequence ---------- */
function startChase(){
  bubble.style.display="block";
  bubble.style.top="0px";
  let bubbleY = 0;
  let playerX = parseInt(player.style.left);
  const chaseInterval = setInterval(()=>{
    if(!alive) { clearInterval(chaseInterval); return; }
    bubbleY += 3;
    bubble.style.top = bubbleY+"px";

    // simple player left/right movement
    if(keys.a) playerX -= 4;
    if(keys.d) playerX += 4;
    if(playerX<0) playerX=0;
    if(playerX>window.innerWidth-50) playerX = window.innerWidth-50;
    player.style.left = playerX+"px";

    // bubble reaches bottom → show door
    if(bubbleY >= window.innerHeight-150){
      clearInterval(chaseInterval);
      bubble.style.display="none";
      finalDoor.style.display="block";
    }
  },16);
}

/* Click final door to proceed */
finalDoor.addEventListener("click", ()=>{
  location.href="finalSequence.html"; // Page 2
});
</script>

</body>
</html>
