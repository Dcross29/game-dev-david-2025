<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Final Level - Chase</title>
<style>
body{
  margin:0;
  overflow:hidden;
  font-family:arial;
  background:black;
}

/* WORLD */
#world{
  position:absolute;
  width:100%;
  height:300vh; /* giant vertical map */
  top:0;
}

/* FLOORS */
#firstFloor{
  height:100vh;
  background:#8B4513;
  position:relative;
}
#secondFloor{
  height:200vh;
  background:#222;
  position:relative;
}

/* Bed */
#bed{
  position:absolute;
  width:180px;
  height:60px;
  background:#5a2d0c;
  left:80px;
  bottom:40px;
  border-radius:10px;
}
#bed:before{
  content:"";
  position:absolute;
  width:180px;
  height:25px;
  background:#c68642;
  top:-25px;
  border-radius:10px 10px 0 0;
}

/* Stairs */
#stairs{
  position:absolute;
  right:80px;
  bottom:0;
  width:200px;
}
#stairs div{
  height:20px;
  background:#3b1f0b;
  margin-top:4px;
}

/* Player */
#player{
  position:absolute;
  z-index:10;
}

/* Bubble */
#bubble{
  position:absolute;
  width:90px;
  display:none;
  z-index:9;
}

/* Door */
#door{
  position:absolute;
  bottom:50px; /* very far down the second floor */
  left:50%;
  transform:translateX(-50%);
  width:140px;
  height:220px;
  background:#111;
  border:4px solid white;
  text-align:center;
  color:white;
  line-height:220px;
  font-size:22px;
}

/* Dialogue */
#dialogue{
  position:fixed;
  bottom:30px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.85);
  padding:15px 25px;
  color:white;
  border-radius:12px;
  display:none;
  z-index:100;
}

/* Run text */
#runText{
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  color:red;
  font-size:26px;
  display:none;
  z-index:200;
}
</style>
</head>
<body>

<div id="world">
  <div id="firstFloor">
    <div id="bed"></div>
    <div id="stairs">
      <div></div><div></div><div></div><div></div><div></div>
    </div>
  </div>
  <div id="secondFloor">
    <div id="door">EXIT</div>
  </div>
</div>

<img id="player" src="mc.PNG">
<img id="bubble" src="bubbleboss.gif">

<div id="runText">RUN â†“</div>
<div id="dialogue"></div>

<script>
const player = document.getElementById("player");
const bubble = document.getElementById("bubble");
const stairs = document.getElementById("stairs");
const dialogue = document.getElementById("dialogue");
const world = document.getElementById("world");
const door = document.getElementById("door");
const runText = document.getElementById("runText");

let keys = {};
let px=120, py=70;
let bx=0, by=0;
let worldY=0;

let atStairs=false;
let onSecondFloor=false;
let locked=false;
let chasing=false;

/* INPUT */
document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

/* START */
player.style.left=px+"px";
player.style.bottom=py+"px";

/* MAIN LOOP */
setInterval(()=>{
  if(!locked) movePlayer();
  stairCheck();
  chaseLogic();
  autoScroll();
  doorCheck();
},16);

/* PLAYER MOVE */
function movePlayer(){
  if(keys.a) px-=4;
  if(keys.d) px+=4;
  if(keys.w) py+=4;
  if(keys.s) py-=4;

  px=Math.max(0, Math.min(window.innerWidth-player.width, px));
  py=Math.max(0, Math.min(window.innerHeight-player.height, py));

  player.style.left=px+"px";
  player.style.bottom=py+"px";
}

/* STAIRS */
function stairCheck(){
  if(onSecondFloor) return;

  const s = stairs.getBoundingClientRect();
  const p = player.getBoundingClientRect();
  const hit = !(p.right < s.left || p.left > s.right || p.bottom < s.top || p.top > s.bottom);

  if(hit && !atStairs){
    atStairs = true;
    show(`<button onclick="goDown()">Go downstairs</button>`);
  }
  if(!hit){
    atStairs = false;
    hide();
  }
}

/* GO DOWN */
function goDown(){
  hide();
  onSecondFloor=true;

  // Move world to show second floor
  worldY = -window.innerHeight;
  world.style.top = worldY + "px";

  // Player position
  px = window.innerWidth/2;
  py = 80;
  player.style.left = px + "px";
  player.style.bottom = py + "px";

  // Bubble at top
  bubble.style.display = "block";
  bx = window.innerWidth/2;
  by = window.innerHeight - 120;
  bubble.style.left = bx + "px";
  bubble.style.bottom = by + "px";

  locked = true;
  setTimeout(bubbleDialogue, 500);
}

/* DIALOGUE */
function bubbleDialogue(){
  show(`
    "Join me or die."<br><br>
    <button onclick="refuse()">Refuse</button>
  `);
}

/* REFUSE */
function refuse(){
  hide();
  runText.style.display = "block";
  locked = false;
  // 2 sec headstart
  setTimeout(()=>{ chasing=true; }, 2000);
}

/* CHASE */
function chaseLogic(){
  if(!chasing) return;

  // Bubble moves toward player
  let dx = px - bx;
  let dy = py - by;
  let dist = Math.sqrt(dx*dx + dy*dy) || 1;
  let speed = 2.5;
  bx += (dx/dist)*speed;
  by += (dy/dist)*speed;

  // Bubble position relative to world scroll
  bubble.style.left = bx + "px";
  bubble.style.bottom = by + worldY + "px";
}

/* AUTO SCROLL */
function autoScroll(){
  if(!chasing) return;

  const scrollSpeed = 2;
  worldY -= scrollSpeed; // move world down
  world.style.top = worldY + "px";

  // Bubble moves with scroll
  bubble.style.bottom = by + worldY + "px";
}

/* DOOR */
function doorCheck(){
  if(!chasing) return;

  const d = door.getBoundingClientRect();
  const p = player.getBoundingClientRect();
  const hit = !(p.right<d.left || p.left>d.right || p.bottom<d.top || p.top>d.bottom);

  if(hit){
    location.href="level2.html";
  }
}

/* UI */
function show(t){
  dialogue.innerHTML = t;
  dialogue.style.display = "block";
}
function hide(){
  dialogue.style.display = "none";
}
</script>
</body>
</html>
