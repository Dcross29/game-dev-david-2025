<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Floor 2 - Generator</title>
<style>
body{
  margin:0;
  background:#222;
  font-family:arial;
  height:100vh;
  color:white;
  user-select:none;
}

.generator{
  position:absolute;
  bottom:80px;
  width:160px;
  height:160px;
  z-index:10;
}

.button{
  position:absolute;
  padding:6px 12px;
  font-size:14px;
  cursor:pointer;
  z-index:20;
}

#main-gen{ left:28%; }
#window-gen{ left:55%; }

#btn-main{ left:28%; bottom:30px; }
#btn-window{ left:55%; bottom:30px; }

.window-img{
  position:absolute;
  top:40px;
  width:120px;
  height:250px;
  z-index:5;
}

#window-left{ left:60px; }
#window-center{ left:calc(50% - 60px); }
#window-right{ right:60px; }

#btn-left{ left:60px; top:320px; }
#btn-center{ left:calc(50% - 60px); top:320px; }
#btn-right{ right:60px; top:320px; }

.bar{
  position:absolute;
  width:240px;
  height:20px;
  background:#333;
  border:2px solid #888;
  z-index:15; /* above generators */
}

.fill{ height:100%; width:0%; }

#main-bar{ left:26%; bottom:250px; }
#main-fill{ background:lime; }

#window-bar{ left:53%; bottom:250px; }
#window-fill{ background:cyan; }

#guide{
  position:fixed;
  bottom:15px;
  right:15px;
  background:rgba(0,0,0,0.7);
  padding:12px;
  font-size:14px;
  line-height:1.4;
  border:1px solid #666;
  z-index:30;
  width:220px;
}

#victory,#death{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  font-size:48px;
  text-align:center;
  line-height:100vh;
  display:none;
  z-index:999;
}
</style>
</head>
<body>

<img id="main-gen" class="generator" src="generatoroff.gif">
<button id="btn-main" class="button">HOLD MAIN</button>

<img id="window-gen" class="generator" src="generatoroff.gif">
<button id="btn-window" class="button">HOLD WINDOW</button>

<img id="window-left" class="window-img" src="window.gif">
<button id="btn-left" class="button">CLOSE</button>

<img id="window-center" class="window-img" src="window.gif">
<button id="btn-center" class="button">CLOSE</button>

<img id="window-right" class="window-img" src="window.gif">
<button id="btn-right" class="button">CLOSE</button>

<div id="main-bar" class="bar"><div id="main-fill" class="fill"></div></div>
<div id="window-bar" class="bar"><div id="window-fill" class="fill"></div></div>

<div id="guide">
<b>GUIDE:</b><br>
Hold <b>MAIN</b> generator to pop the bubble.<br>
Hold <b>WINDOW</b> generator to help close bubble windows.<br>
Click the open bubble window to close it before it kills you.
</div>

<div id="victory">THE BUBBLE IS POPPED</div>
<div id="death">DEATH</div>

<script>
let mainPower = 0;
let windowPower = 0;
let holdMain = false;
let holdWindow = false;
let bubbleActive = false;
let bubbleIndex = -1;
let bubbleTimer = null;
let gameOver = false;
let difficulty = 1; // difficulty ramp

const windows = [
  document.getElementById("window-left"),
  document.getElementById("window-center"),
  document.getElementById("window-right")
];

const mainFill = document.getElementById("main-fill");
const windowFill = document.getElementById("window-fill");
const mainGen = document.getElementById("main-gen");
const windowGen = document.getElementById("window-gen");

let mainOn = false;
let windowOn = false;

/* HOLD LOGIC */
const hold = (btn, start, stop)=>{
  btn.addEventListener("pointerdown", start);
  btn.addEventListener("pointerup", stop);
  btn.addEventListener("pointerleave", stop);
  btn.addEventListener("pointercancel", stop);
};

hold(document.getElementById("btn-main"),
  ()=> holdMain = true,
  ()=> holdMain = false
);

hold(document.getElementById("btn-window"),
  ()=> holdWindow = true,
  ()=> holdWindow = false
);

/* WINDOW BUTTONS */
["btn-left","btn-center","btn-right"].forEach((id,i)=>{
  document.getElementById(id).onclick = ()=>{
    if(!bubbleActive) return;
    if(i !== bubbleIndex) return;
    if(windowPower < 10) return;

    windowPower -= 10;
    windowFill.style.width = windowPower + "%";
    windows[i].src = "window.gif";
    clearTimeout(bubbleTimer);
    bubbleActive = false;
  };
});

/* SPAWN BUBBLE */
function spawnBubble(){
  if(bubbleActive || gameOver) return;

  bubbleIndex = Math.floor(Math.random()*3);
  windows[bubbleIndex].src = "windowopen.gif";
  bubbleActive = true;

  // bubble kill timer decreases with difficulty
  let killTime = Math.max(800, 2000 - difficulty*150); 
  bubbleTimer = setTimeout(()=>{
    document.getElementById("death").style.display="block";
    gameOver = true;
  }, killTime);
}

/* DIFFICULTY RAMP */
setInterval(()=>{
  if(gameOver) return;
  difficulty += 0.01; // slowly increases over time
},1000);

/* BUBBLE SPAWN LOOP */
setInterval(()=>{
  if(gameOver) return;
  let chance = 0.3 + Math.min(0.6,difficulty*0.02);
  if(Math.random() < chance) spawnBubble();
},3500);

/* GAME LOOP */
setInterval(()=>{
  if(gameOver) return;

  // MAIN GENERATOR
  if(holdMain && !bubbleActive){
    mainPower = Math.min(100, mainPower + 0.03);
    mainFill.style.width = mainPower + "%";
    if(!mainOn){ mainGen.src="generatoron.gif"; mainOn=true; }
    if(mainPower >= 100){
      document.getElementById("victory").style.display="block";
      gameOver = true;
    }
  } else if(mainOn){ mainGen.src="generatoroff.gif"; mainOn=false; }

  // WINDOW GENERATOR
  if(holdWindow){
    let windowRate = 0.3 + difficulty*0.002; // gradually faster
    windowPower = Math.min(100, windowPower + windowRate);
    windowFill.style.width = windowPower + "%";
    if(!windowOn){ windowGen.src="generatoron.gif"; windowOn=true; }
  } else {
    // gradually drain 2% per second => 0.02 per 16ms tick ~0.000333
    windowPower = Math.max(0, windowPower - 0.02/60);
    windowFill.style.width = windowPower + "%";
    if(windowOn){ windowGen.src="generatoroff.gif"; windowOn=false; }
  }

},16);
</script>

</body>
</html>
