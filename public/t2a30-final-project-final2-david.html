<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Floor 2 - Generator</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#222;
  font-family:arial;
  height:100vh;
  color:white;
}

/* FADE IN OVERLAY */
#fade-in{
  position:fixed;
  inset:0;
  background:black;
  opacity:1;
  pointer-events:none;
  transition:opacity 2s ease;
  z-index:2000;
}
#fade-in.hide{ opacity:0; }

#generator{
  position:absolute;
  bottom:50px;
  left:50%;
  transform:translateX(-50%);
  width:200px;
  height:200px;
  z-index:5;
}

#holdw{
  position:absolute;
  bottom:260px;
  left:50%;
  transform:translateX(-50%);
  font-size:22px;
  font-weight:bold;
}

.window-img{
  position:absolute;
  top:50px;
  width:120px;
  height:250px;
}

.window-label{
  position:absolute;
  top:320px;
  width:120px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}

#window-left{left:50px;}
#label-a{left:50px;}

#window-center{left:calc(50% - 60px);}
#label-s{left:calc(50% - 60px);}

#window-right{right:50px;}
#label-d{right:50px;}

#progress-bar{
  position:absolute;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:300px;
  height:25px;
  background:#333;
  border:2px solid #888;
}

#progress-fill{
  height:100%;
  width:0%;
  background:lime;
}

#briefing{
  position:fixed;
  bottom:15px;
  right:15px;
  width:260px;
  background:rgba(0,0,0,0.7);
  padding:12px;
  font-size:14px;
  line-height:1.4;
  border:1px solid #666;
}

#victory-screen, #death-screen{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  color:white;
  font-size:48px;
  text-align:center;
  line-height:100vh;
  display:none;
  z-index:3000;
}
</style>
</head>

<body>

<div id="fade-in"></div>

<div id="briefing">
<b>OBJECTIVE</b><br>
Hold <b>W</b> to power the generator.<br><br>
Bubbles open windows.<br>
Press <b>A</b>, <b>S</b>, or <b>D</b> to close them.<br>
<b>Closing a window costs power.</b>
</div>

<div id="holdw">HOLD W</div>

<img id="generator" src="generatoroff.gif">

<img id="window-left" class="window-img" src="window.gif">
<div id="label-a" class="window-label">A</div>

<img id="window-center" class="window-img" src="window.gif">
<div id="label-s" class="window-label">S</div>

<img id="window-right" class="window-img" src="window.gif">
<div id="label-d" class="window-label">D</div>

<div id="progress-bar"><div id="progress-fill"></div></div>

<div id="victory-screen">The bubble is popped!</div>
<div id="death-screen">DEATH</div>

<script>
const generator = document.getElementById("generator");
const progressFill = document.getElementById("progress-fill");
const fadeIn = document.getElementById("fade-in");

const windows = {
  a: document.getElementById("window-left"),
  s: document.getElementById("window-center"),
  d: document.getElementById("window-right")
};

let keys = {};
let progress = 0;
let gameOver = false;
let bubbleActive = false;
let bubbleWindow = null;
let bubbleTimer = null;
let genOn = false;

/* FADE IN */
window.addEventListener("load",()=>{
  requestAnimationFrame(()=>fadeIn.classList.add("hide"));
});

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup",   e => keys[e.key.toLowerCase()] = false);

/* SPAWN BUBBLE */
function spawnBubbleForKey(key){
  if(gameOver || bubbleActive) return;

  const win = windows[key];
  win.src = "windowopen.gif";

  bubbleActive = true;
  bubbleWindow = key;

  bubbleTimer = setTimeout(()=>{
    if(win.src.includes("windowopen.gif")){
      endGame(false);
    }
  },1800); // ðŸ’€ faster kill timer
}

/* CLOSE WINDOW â€” COSTS POWER */
function closeWindow(key){
  windows[key].src = "window.gif";

  progress = Math.max(0, progress - 5);
  progressFill.style.width = progress + "%";

  clearTimeout(bubbleTimer);
  bubbleActive = false;
  bubbleWindow = null;
}

/* END GAME */
function endGame(victory){
  gameOver = true;

  document.getElementById(
    victory ? "victory-screen" : "death-screen"
  ).style.display = "block";

  Object.values(windows).forEach(w => w.src = "window.gif");
  generator.src = "generatoroff.gif";
  genOn = false;

  if(bubbleTimer) clearTimeout(bubbleTimer);
}

/* BUBBLE FREQUENCY â€” MUCH HIGHER */
setInterval(()=>{
  if(gameOver || bubbleActive) return;

  if(Math.random() < 0.95){
    const keysArr = Object.keys(windows);
    spawnBubbleForKey(keysArr[Math.floor(Math.random()*3)]);
  }
},2500);

/* MAIN LOOP */
setInterval(()=>{
  if(gameOver) return;

  /* GENERATOR */
  if(keys.w && progress < 100 && !bubbleActive){
    progress += 0.03;
    progressFill.style.width = progress + "%";

    if(!genOn){
      generator.src = "generatoron.gif";
      genOn = true;
    }
  } else if(genOn){
    generator.src = "generatoroff.gif";
    genOn = false;
  }

  /* WINDOW CLOSE */
  if(bubbleActive && keys[bubbleWindow]){
    closeWindow(bubbleWindow);
  }

  if(progress >= 100){
    endGame(true);
  }

},16);
</script>

</body>
</html>
