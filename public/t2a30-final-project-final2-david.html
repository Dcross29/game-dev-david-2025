<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Final Level - Floor 2 Generator</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:#222;
  font-family:arial;
  height:100vh;
}
#player{
  position:absolute;
  left:50%;
  bottom:50px;
  transform:translateX(-50%);
  width:60px;
  z-index:10;
}
#generator{
  position:absolute;
  bottom:50px;
  left:50%;
  transform:translateX(-50%);
  width:200px;
  height:200px;
  background:#444;
  border:4px solid #888;
  border-radius:12px;
  text-align:center;
  line-height:200px;
  font-size:20px;
  color:white;
  z-index:5;
}
.window{
  position:absolute;
  top:50px;
  width:120px;
  height:250px;
  background:#555;
  border:3px solid #888;
  border-radius:6px;
  text-align:center;
  line-height:250px;
  font-size:20px;
  color:white;
}
#window-left{left:50px;}
#window-center{left:calc(50% - 60px);}
#window-right{right:50px;}
#bubble{
  position:absolute;
  width:80px;
  height:auto;
  display:none;
  z-index:15;
  transition: top 0.2s linear;
}
#progress-bar{
  position:absolute;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:300px;
  height:25px;
  background:#333;
  border:2px solid #888;
}
#progress-fill{
  height:100%;
  width:0%;
  background:lime;
}
#message{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:24px;
}
</style>
</head>
<body>

<img id="player" src="mc.PNG">
<div id="generator">GENERATOR</div>
<div id="window-left" class="window">A</div>
<div id="window-center" class="window">S</div>
<div id="window-right" class="window">D</div>
<img id="bubble" src="bubbleboss.gif">
<div id="progress-bar"><div id="progress-fill"></div></div>
<div id="message"></div>

<script>
const player = document.getElementById("player");
const generator = document.getElementById("generator");
const bubble = document.getElementById("bubble");
const message = document.getElementById("message");
const progressFill = document.getElementById("progress-fill");

const windows = {
  a: document.getElementById("window-left"),
  s: document.getElementById("window-center"),
  d: document.getElementById("window-right")
};

let keys = {};
let progress = 0;
let bubbleActive = false;
let bubbleWindow = null;
let gameOver = false;

// WASD key input
document.addEventListener("keydown", e => keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()]=false);

// Main loop
setInterval(()=>{
  if(gameOver) return;

  // Holding W increases generator slowly
  if(keys.w && progress < 100) {
    progress += 0.05; // slower now
    progressFill.style.width = progress + "%";
  }

  // Bubble random spawn more frequently
  if(!bubbleActive && Math.random() < 0.01){ // higher chance each frame
    const options = ['a','s','d'];
    bubbleWindow = options[Math.floor(Math.random()*3)];
    const winEl = windows[bubbleWindow];
    const rect = winEl.getBoundingClientRect();
    bubble.style.left = rect.left + rect.width/2 - 40 + "px";
    bubble.style.top = rect.top + "px";
    bubble.style.display = "block";
    bubbleActive = true;
    bubble.approach = 0;
    message.innerText = "Bubble! Press " + bubbleWindow.toUpperCase() + "!";
  }

  // Move bubble closer to player as "threat"
  if(bubbleActive){
    bubble.approach += 2; // speed of approach
    const winEl = windows[bubbleWindow];
    const rect = winEl.getBoundingClientRect();
    bubble.style.top = rect.top + bubble.approach + "px";

    // Check if player presses correct key
    if(keys[bubbleWindow]){
      bubble.style.display = "none";
      bubbleActive = false;
      bubbleWindow = null;
      message.innerText = "Good!";
    }

    // If bubble reaches bottom = death
    const bubbleRect = bubble.getBoundingClientRect();
    if(bubbleRect.bottom >= window.innerHeight - 60){
      gameOver = true;
      message.innerText = "You got caught! GAME OVER";
      alert("You died! Reload to try again.");
    }
  }

  // Check if generator completed
  if(progress>=100){
    gameOver = true;
    message.innerText = "Generator complete! You survive!";
    alert("You win! Move to next level.");
    window.location.href = "nextlevel.html"; // change this to your next level file
  }

},16);
</script>

</body>
</html>
