<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Floor 2 - Generator</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:#222;
  font-family:arial;
  height:100vh;
}
#generator{
  position:absolute;
  bottom:50px;
  left:50%;
  transform:translateX(-50%);
  width:200px;
  height:200px;
  z-index:5;
}
.window-img{
  position:absolute;
  top:50px;
  width:120px;
  height:250px;
}
#window-left{left:50px;}
#window-center{left:calc(50% - 60px);}
#window-right{right:50px;}
#progress-bar{
  position:absolute;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:300px;
  height:25px;
  background:#333;
  border:2px solid #888;
}
#progress-fill{
  height:100%;
  width:0%;
  background:lime;
}
#message{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  color:white;
  font-size:20px;
  text-align:center;
  width:100%;
}
#victory-screen, #death-screen{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.9);
  color:white;
  font-size:48px;
  text-align:center;
  line-height:100vh;
  display:none;
  z-index:1000;
}
</style>
</head>
<body>

<img id="generator" src="generator.png"> <!-- your generator image -->
<img id="window-left" class="window-img" src="window.gif">
<img id="window-center" class="window-img" src="window.gif">
<img id="window-right" class="window-img" src="window.gif">

<div id="progress-bar"><div id="progress-fill"></div></div>
<div id="message">Hold W to charge generator. Close bubble windows with A (left), S (center), D (right)!</div>

<div id="victory-screen">VICTORY!</div>
<div id="death-screen">DEATH!</div>

<script>
const generator = document.getElementById("generator");
const message = document.getElementById("message");
const progressFill = document.getElementById("progress-fill");

const windows = {
  a: document.getElementById("window-left"),
  s: document.getElementById("window-center"),
  d: document.getElementById("window-right")
};

let keys = {};
let progress = 0;
let gameOver = false;

// Bubble timers for each window
const bubbleTimers = {
  a: null,
  s: null,
  d: null
};

// WASD input
document.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

// Spawn bubble in a random window
function spawnBubble(){
  if(gameOver) return;
  const options = ['a','s','d'];
  const key = options[Math.floor(Math.random()*3)];
  const winEl = windows[key];

  // switch to danger image
  winEl.src = "danger.gif";
  message.innerText = `Bubble in ${key.toUpperCase()}! Press ${key.toUpperCase()} to close!`;

  // start 3s death timer
  bubbleTimers[key] = setTimeout(()=>{
    if(winEl.src.includes("danger.gif")){
      endGame(false); // death
    }
  },3000);
}

// End game
function endGame(victory){
  gameOver = true;
  if(victory){
    document.getElementById("victory-screen").style.display = "block";
  } else {
    document.getElementById("death-screen").style.display = "block";
  }
}

// Main loop
setInterval(()=>{
  if(gameOver) return;

  // Holding W charges generator slowly
  if(keys.w && progress < 100){
    progress += 0.03; // slow
    progressFill.style.width = progress + "%";
  }

  // Bubble randomly appears more often
  if(Math.random() < 0.02){
    // choose a window not currently in danger
    const available = Object.keys(windows).filter(k => !windows[k].src.includes("danger.gif"));
    if(available.length > 0){
      const key = available[Math.floor(Math.random()*available.length)];
      spawnBubbleForKey(key);
    }
  }

  // Check if player pressed correct key
  ['a','s','d'].forEach(key=>{
    if(keys[key] && windows[key].src.includes("danger.gif")){
      // safe the window
      windows[key].src = "window.gif";
      clearTimeout(bubbleTimers[key]);
      bubbleTimers[key] = null;
      message.innerText = "Window safe!";
    }
  });

  // Check if generator completed
  if(progress >= 100){
    endGame(true);
  }

},16);

// helper to spawn bubble for a specific window
function spawnBubbleForKey(key){
  const winEl = windows[key];
  winEl.src = "danger.gif";
  message.innerText = `Bubble in ${key.toUpperCase()}! Press ${key.toUpperCase()} to close!`;
  bubbleTimers[key] = setTimeout(()=>{
    if(winEl.src.includes("danger.gif")){
      endGame(false);
    }
  },3000);
}
</script>

</body>
</html>
