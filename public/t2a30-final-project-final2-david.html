<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Floor 2 - Generator</title>

<style>
body{
  margin:0;
  background:#222;
  font-family:arial;
  height:100vh;
  color:white;
  user-select:none;
}

/* ---------- LAYOUT ---------- */
.generator{
  position:absolute;
  bottom:80px;
  width:160px;
  height:160px;
  z-index:10;
}

.button{
  position:absolute;
  padding:6px 12px;
  font-size:14px;
  cursor:pointer;
  z-index:20;
}

#main-gen{ left:28%; }
#window-gen{ left:55%; }

#btn-main{ left:28%; bottom:30px; }
#btn-window{ left:55%; bottom:30px; }

.window-img{
  position:absolute;
  top:40px;
  width:120px;
  height:250px;
  z-index:5;
}

#window-left{ left:60px; }
#window-center{ left:calc(50% - 60px); }
#window-right{ right:60px; }

#btn-left{ left:60px; top:320px; }
#btn-center{ left:calc(50% - 60px); top:320px; }
#btn-right{ right:60px; top:320px; }

.bar{
  position:absolute;
  bottom:140px;
  width:240px;
  height:20px;
  background:#333;
  border:2px solid #888;
}

.fill{ height:100%; width:0%; }

#main-bar{ left:26%; }
#main-fill{ background:lime; }

#window-bar{ left:53%; }
#window-fill{ background:cyan; }

#victory,#death{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  font-size:48px;
  text-align:center;
  line-height:100vh;
  display:none;
  z-index:999;
}
</style>
</head>

<body>

<img id="main-gen" class="generator" src="generatoroff.gif">
<button id="btn-main" class="button">HOLD MAIN</button>

<img id="window-gen" class="generator" src="generatoroff.gif">
<button id="btn-window" class="button">HOLD WINDOW</button>

<img id="window-left" class="window-img" src="window.gif">
<button id="btn-left" class="button">CLOSE</button>

<img id="window-center" class="window-img" src="window.gif">
<button id="btn-center" class="button">CLOSE</button>

<img id="window-right" class="window-img" src="window.gif">
<button id="btn-right" class="button">CLOSE</button>

<div id="main-bar" class="bar"><div id="main-fill" class="fill"></div></div>
<div id="window-bar" class="bar"><div id="window-fill" class="fill"></div></div>

<div id="victory">THE BUBBLE IS POPPED</div>
<div id="death">DEATH</div>

<script>
/* ---------- STATE ---------- */
let mainPower = 0;
let windowPower = 0;
let holdMain = false;
let holdWindow = false;
let bubbleActive = false;
let bubbleIndex = -1;
let bubbleTimer = null;
let gameOver = false;

const windows = [
  document.getElementById("window-left"),
  document.getElementById("window-center"),
  document.getElementById("window-right")
];

const mainFill = document.getElementById("main-fill");
const windowFill = document.getElementById("window-fill");
const mainGen = document.getElementById("main-gen");
const windowGen = document.getElementById("window-gen");

/* ---------- HOLD LOGIC (POINTER EVENTS) ---------- */
const hold = (btn, start, stop)=>{
  btn.addEventListener("pointerdown", start);
  btn.addEventListener("pointerup", stop);
  btn.addEventListener("pointercancel", stop);
  btn.addEventListener("pointerleave", stop);
};

hold(document.getElementById("btn-main"),
  ()=> holdMain = true,
  ()=> holdMain = false
);

hold(document.getElementById("btn-window"),
  ()=> holdWindow = true,
  ()=> holdWindow = false
);

/* ---------- WINDOW BUTTONS ---------- */
["btn-left","btn-center","btn-right"].forEach((id,i)=>{
  document.getElementById(id).onclick = ()=>{
    if(!bubbleActive) return;
    if(i !== bubbleIndex) return;
    if(windowPower < 10) return;

    windowPower -= 10;
    windowFill.style.width = windowPower + "%";
    windows[i].src = "window.gif";
    clearTimeout(bubbleTimer);
    bubbleActive = false;
  };
});

/* ---------- BUBBLES ---------- */
function spawnBubble(){
  if(bubbleActive || gameOver) return;

  bubbleIndex = Math.floor(Math.random()*3);
  windows[bubbleIndex].src = "windowopen.gif";
  bubbleActive = true;

  bubbleTimer = setTimeout(()=>{
    document.getElementById("death").style.display="block";
    gameOver = true;
  },1400);
}

setInterval(()=>{ if(Math.random()<0.9) spawnBubble(); },2000);

/* ---------- GAME LOOP ---------- */
setInterval(()=>{
  if(gameOver) return;

  if(holdMain && !bubbleActive){
    mainPower = Math.min(100, mainPower + 0.03);
    mainFill.style.width = mainPower + "%";
    mainGen.src = "generatoron.gif";
    if(mainPower >= 100){
      document.getElementById("victory").style.display="block";
      gameOver = true;
    }
  } else mainGen.src = "generatoroff.gif";

  if(holdWindow){
    windowPower = Math.min(100, windowPower + 0.3);
    windowFill.style.width = windowPower + "%";
    windowGen.src = "generatoron.gif";
  } else windowGen.src = "generatoroff.gif";

},16);
</script>

</body>
</html>
