<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Floor 2 - Generator</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#222;
  font-family:arial;
  height:100vh;
  color:white;
  user-select:none;
}

#fade-in{
  position:fixed;
  inset:0;
  background:black;
  opacity:1;
  transition:opacity 2s ease;
  z-index:2000;
}
#fade-in.hide{opacity:0;}

.generator{
  position:absolute;
  bottom:50px;
  width:160px;
  height:160px;
}

.button{
  position:absolute;
  padding:6px 10px;
  font-size:14px;
  cursor:pointer;
}

#main-gen{ left:30%; }
#window-gen{ left:55%; }

#btn-main{ left:30%; bottom:20px; }
#btn-window{ left:55%; bottom:20px; }

.window-img{
  position:absolute;
  top:50px;
  width:120px;
  height:250px;
}

#window-left{left:50px;}
#window-center{left:calc(50% - 60px);}
#window-right{right:50px;}

#btn-left{ left:50px; top:320px; }
#btn-center{ left:calc(50% - 60px); top:320px; }
#btn-right{ right:50px; top:320px; }

.bar{
  position:absolute;
  bottom:90px;
  width:240px;
  height:20px;
  background:#333;
  border:2px solid #888;
}
.fill{ height:100%; width:0%; }

#main-bar{ left:28%; }
#main-fill{ background:lime; }

#window-bar{ left:53%; }
#window-fill{ background:cyan; }

#victory-screen,#death-screen{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  font-size:48px;
  text-align:center;
  line-height:100vh;
  display:none;
  z-index:3000;
}
</style>
</head>

<body>

<div id="fade-in"></div>

<img id="main-gen" class="generator" src="generatoroff.gif">
<button id="btn-main" class="button">HOLD MAIN GEN</button>

<img id="window-gen" class="generator" src="generatoroff.gif">
<button id="btn-window" class="button">HOLD WINDOW GEN</button>

<img id="window-left" class="window-img" src="window.gif">
<button id="btn-left" class="button">CLOSE</button>

<img id="window-center" class="window-img" src="window.gif">
<button id="btn-center" class="button">CLOSE</button>

<img id="window-right" class="window-img" src="window.gif">
<button id="btn-right" class="button">CLOSE</button>

<div id="main-bar" class="bar"><div id="main-fill" class="fill"></div></div>
<div id="window-bar" class="bar"><div id="window-fill" class="fill"></div></div>

<div id="victory-screen">THE BUBBLE IS POPPED</div>
<div id="death-screen">DEATH</div>

<script>
const fadeIn = document.getElementById("fade-in");

const mainGen = document.getElementById("main-gen");
const windowGen = document.getElementById("window-gen");

const mainFill = document.getElementById("main-fill");
const windowFill = document.getElementById("window-fill");

const windows = [
  document.getElementById("window-left"),
  document.getElementById("window-center"),
  document.getElementById("window-right")
];

const windowButtons = [
  document.getElementById("btn-left"),
  document.getElementById("btn-center"),
  document.getElementById("btn-right")
];

let mainPower = 0;
let windowPower = 0;
let holdingMain = false;
let holdingWindow = false;

let gameOver = false;
let bubbleActive = false;
let bubbleWindow = null;
let bubbleTimer = null;

/* FADE IN */
window.addEventListener("load",()=>{
  requestAnimationFrame(()=>fadeIn.classList.add("hide"));
});

/* HOLD BUTTONS */
document.getElementById("btn-main").onmousedown = ()=> holdingMain = true;
document.getElementById("btn-window").onmousedown = ()=> holdingWindow = true;

document.onmouseup = ()=>{
  holdingMain = false;
  holdingWindow = false;
  mainGen.src = "generatoroff.gif";
  windowGen.src = "generatoroff.gif";
};

/* WINDOW CLOSE BUTTONS */
windowButtons.forEach((btn,i)=>{
  btn.onclick = ()=>{
    if(!bubbleActive || windows[i] !== bubbleWindow) return;
    if(windowPower < 10) return;

    windowPower -= 10;
    windowFill.style.width = windowPower + "%";

    windows[i].src = "window.gif";
    clearTimeout(bubbleTimer);
    bubbleActive = false;
    bubbleWindow = null;
  };
});

/* SPAWN BUBBLE */
function spawnBubble(){
  if(gameOver || bubbleActive) return;

  const i = Math.floor(Math.random()*windows.length);
  bubbleWindow = windows[i];
  bubbleWindow.src = "windowopen.gif";
  bubbleActive = true;

  bubbleTimer = setTimeout(()=>{
    if(bubbleWindow.src.includes("windowopen")){
      endGame(false);
    }
  },1500);
}

/* END GAME */
function endGame(victory){
  gameOver = true;
  document.getElementById(victory ? "victory-screen" : "death-screen").style.display = "block";
  if(bubbleTimer) clearTimeout(bubbleTimer);
}

/* GAME LOOP */
setInterval(()=>{
  if(gameOver) return;

  if(holdingMain && !bubbleActive){
    mainPower = Math.min(100, mainPower + 0.03);
    mainFill.style.width = mainPower + "%";
    mainGen.src = "generatoron.gif";
    if(mainPower >= 100) endGame(true);
  }

  if(holdingWindow){
    windowPower = Math.min(100, windowPower + 0.25);
    windowFill.style.width = windowPower + "%";
    windowGen.src = "generatoron.gif";
  }
},16);

/* BUBBLE PRESSURE */
setInterval(()=>{
  if(Math.random() < 0.9){
    spawnBubble();
  }
},2200);
</script>

</body>
</html>
